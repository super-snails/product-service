package com.tsing.product.api.teambuilding.common.impl;import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;import com.baomidou.mybatisplus.core.metadata.IPage;import com.baomidou.mybatisplus.core.toolkit.Wrappers;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import com.tsing.global.result.ResultPageData;import com.tsing.global.utils.ObjectMappingUtil;import com.tsing.product.api.feature.bo.FeatureSaveRequest;import com.tsing.product.api.feature.entity.FeatureEntity;import com.tsing.product.api.feature.mapper.FeatureMapper;import com.tsing.product.api.stroke.bo.request.StorkeSaveRequest;import com.tsing.product.api.stroke.entity.StrokeEntity;import com.tsing.product.api.stroke.mapper.StrokeMapper;import com.tsing.product.api.teambuilding.bo.reponse.TeambuildingBoEntity;import com.tsing.product.api.teambuilding.bo.request.TeambildingPage;import com.tsing.product.api.teambuilding.bo.request.TeambuildingDeleteRequest;import com.tsing.product.api.teambuilding.bo.request.TeambuildingSaveRequest;import com.tsing.product.api.teambuilding.bo.request.TeambuildingUpdateRequest;import com.tsing.product.api.teambuilding.common.TeambuildingCommonService;import com.tsing.product.api.teambuilding.entity.TeambuildingEntity;import com.tsing.product.api.teambuilding.mapper.TeambuildingMapper;import org.springframework.stereotype.Service;import java.util.List;import javax.annotation.Resource;import cn.hutool.core.collection.CollectionUtil;import cn.hutool.json.JSONUtil;/** * @author Tsing * @version 0.0.1 * @date 2021/8/1 1:14 下午 * @description: 团建游产品核心处理类 */@Servicepublic class TeambuildingCommonServiceImpl implements TeambuildingCommonService {    @Resource    private TeambuildingMapper teambuildingMapper;    @Resource    private FeatureMapper featureMapper;    @Resource    private StrokeMapper strokeMapper;    @Override    public Page<TeambuildingEntity> pagingQuery(TeambildingPage pageParam) {        QueryWrapper<TeambuildingEntity> queryWrapper = new QueryWrapper<>();        return teambuildingMapper.selectPage(new Page<>(pageParam.getPage(), pageParam.getPageSize()), queryWrapper);    }    @Override    public ResultPageData<TeambuildingBoEntity> coverTeambuildingPageEntityToBo(Page<TeambuildingEntity> pageEntity) {        IPage<TeambuildingBoEntity> entityPage = pageEntity.convert(entity -> ObjectMappingUtil.map(entity, TeambuildingBoEntity.class));        long pages = entityPage.getPages();        long size = entityPage.getSize();        long total = entityPage.getTotal();        List<TeambuildingBoEntity> records = entityPage.getRecords();        return new ResultPageData<>(pages, size, total, records);    }    @Override    public TeambuildingEntity coverTeambuildingUpdateRequestToEntity(TeambuildingUpdateRequest param) {        return ObjectMappingUtil.map(param, TeambuildingEntity.class);    }    @Override    public Boolean modify(TeambuildingEntity entity) {        return teambuildingMapper.updateById(entity) > 0;    }    @Override    public Boolean delete(TeambuildingDeleteRequest param) {        LambdaQueryWrapper<TeambuildingEntity> queryWrapper = Wrappers.<TeambuildingEntity>lambdaQuery()                                                                .eq(TeambuildingEntity::getId, param.getId());        return teambuildingMapper.delete(queryWrapper) > 0;    }    @Override    public TeambuildingEntity coverTeambuildingSaveRequestToEntity(TeambuildingSaveRequest param) {        TeambuildingEntity teambuildingEntity = ObjectMappingUtil.map(param, TeambuildingEntity.class);        List<String> coverPictureList = param.getCoverPicture();        List<String> tipList = param.getTips();        List<String> expenseDescritionContainList = param.getExpenseDescritionContain();        List<String> expenseDescritionNotContainList = param.getExpenseDescritionNotContain();        List<String> bookingNoticeList = param.getBookingNotice();        teambuildingEntity.setCoverPicture(JSONUtil.toJsonPrettyStr(coverPictureList));        teambuildingEntity.setTips(JSONUtil.toJsonPrettyStr(tipList));        teambuildingEntity.setExpenseDescritionContain(JSONUtil.toJsonPrettyStr(expenseDescritionContainList));        teambuildingEntity.setExpenseDescritionNotContain(JSONUtil.toJsonPrettyStr(expenseDescritionNotContainList));        teambuildingEntity.setBookingNotice(JSONUtil.toJsonPrettyStr(bookingNoticeList));        return teambuildingEntity;    }    @Override    public Boolean save(TeambuildingEntity entity) {        return teambuildingMapper.insert(entity) > 0;    }    @Override    public FeatureEntity coverFeatureSaveRequest(FeatureSaveRequest entity) {        return ObjectMappingUtil.map(entity, FeatureEntity.class);    }    @Override    public Boolean saveFeatureEntity(FeatureEntity entity) {        return featureMapper.insert(entity) > 0;    }    @Override    public List<StrokeEntity> coverStorkeSaveRequest(List<StorkeSaveRequest> storkeList) {        return ObjectMappingUtil.mapAll(storkeList, StrokeEntity.class);    }    @Override    public Boolean saveStorkeEntity(List<StrokeEntity> strokeList, Long teambuildingId) {        if(CollectionUtil.isNotEmpty(strokeList)) {            for (int i = 0; i < strokeList.size(); i++) {                StrokeEntity strokeEntity = strokeList.get(i);                strokeEntity.setTeambuildingId(teambuildingId);                strokeEntity.setSorting(i);                strokeMapper.insert(strokeEntity);            }        }        return true;    }}